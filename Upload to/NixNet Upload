#!/bin/bash

# Function to upload file to NixNet
upload_file() {
    FILE_PATH="$1"

    # Default expiry time (in seconds), if not provided in the config file
    DEFAULT_EXPIRY=0

    # Config file path
    CONFIG_FILE="$HOME/.nixnet_upload.conf"

    # Read expiry time from the config file if it exists
    if [[ -f "$CONFIG_FILE" ]]; then
        EXPIRY=$(cat "$CONFIG_FILE")
    else
        EXPIRY=$DEFAULT_EXPIRY
    fi

    # Upload the file with or without expiry header
    if [[ "$EXPIRY" -ne 0 ]]; then
        RESPONSE=$(curl -s -H "Linx-Expiry: $EXPIRY" -T "$FILE_PATH" "https://up.nixnet.services/upload/")
    else
        RESPONSE=$(curl -s -T "$FILE_PATH" "https://up.nixnet.services/upload/")
    fi

    # Check if the upload was successful
    if [[ $? -ne 0 ]]; then
        zenity --error --title="Error" --text="Failed to upload the file.\n$RESPONSE"
        exit 1
    fi

    # Display the result and copy to clipboard
    echo "$RESPONSE" | xclip -selection clipboard
    zenity --info --title="Upload Complete" --text="File uploaded successfully.\nLink: $RESPONSE\n(Link copied to clipboard)"
}

# Main script
for FILE in "$@"; do
    upload_file "$FILE"
done
