#!/bin/bash

# Function to upload file to Fluffy
upload_file() {
    FILE_PATH="$1"

    # Upload the file
    RESPONSE=$(curl -s -F "file=@${FILE_PATH}" "https://fluffy.cc/upload?json")

    # Check if the upload was successful
    STATUS=$(echo "$RESPONSE" | jq -r '.success')
    if [[ "$STATUS" != "true" ]]; then
        zenity --error --title="Error" --text="Failed to upload the file.\n$RESPONSE"
        exit 1
    fi

    # Extract the raw download link from the response
    LINK=$(echo "$RESPONSE" | jq -r '.uploaded_files[].raw')

    if [ -z "$LINK" ]; then
        zenity --error --title="Error" --text="Failed to extract the upload link."
        exit 1
    fi

    # Display the result and copy to clipboard
    echo "$LINK" | xclip -selection clipboard
    zenity --info --title="Upload Complete" --text="File uploaded successfully.\nLink: $LINK\n(Link copied to clipboard)"
}

# Main script
for FILE in "$@"; do
    upload_file "$FILE"
done
