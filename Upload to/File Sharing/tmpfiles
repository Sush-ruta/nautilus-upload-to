#!/bin/bash

# Function to upload file to TMPFILES
upload_file() {
    FILE_PATH="$1"
    API_URL="https://tmpfiles.org/api/v1/upload"
    MAX_SIZE=$((100 * 1024 * 1024)) # 100 MB in bytes
    
    FILE_SIZE=$(stat --format="%s" "$FILE_PATH")
    
    if [ "$FILE_SIZE" -gt "$MAX_SIZE" ]; then
        zenity --error --title="Error" --text="File size exceeds 100 MB. Maximum allowed file size is 100 MB."
        exit 1
    fi
    
    RESPONSE=$(curl -s -F "file=@$FILE_PATH" "$API_URL")
    
    if echo "$RESPONSE" | grep -q '"data"'; then
        FILE_URL=$(echo "$RESPONSE" | grep -oP '(?<="url":")[^"]*')
        echo "$FILE_URL" | xclip -selection clipboard
        zenity --info --title="Upload Complete" --text="File uploaded successfully.\nURL copied to clipboard: $FILE_URL"
    else
        zenity --error --title="Error" --text="Failed to upload file."
    fi
}

# Main script
for FILE in "$@"; do
    upload_file "$FILE"
done
